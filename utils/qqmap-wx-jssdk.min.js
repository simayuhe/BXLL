var _createClass=function(){function a(e,c){for(var b=0;b<c.length;b++){var d=c[b];d.enumerable=d.enumerable||false;d.configurable=true;if("value" in d){d.writable=true}Object.defineProperty(e,d.key,d)}}return function(d,b,c){if(b){a(d.prototype,b)}if(c){a(d,c)}return d}}();function _classCallCheck(a,b){if(!(a instanceof b)){throw new TypeError("Cannot call a class as a function")}}var ERROR_CONF={KEY_ERR:311,KEY_ERR_MSG:"key格式错误",PARAM_ERR:310,PARAM_ERR_MSG:"请求参数信息有误",SYSTEM_ERR:600,SYSTEM_ERR_MSG:"系统错误",WX_ERR_CODE:1000,WX_OK_CODE:200};var BASE_URL="https://apis.map.qq.com/ws/";var URL_SEARCH=BASE_URL+"place/v1/search";var URL_SUGGESTION=BASE_URL+"place/v1/suggestion";var URL_GET_GEOCODER=BASE_URL+"geocoder/v1/";var URL_CITY_LIST=BASE_URL+"district/v1/list";var URL_AREA_LIST=BASE_URL+"district/v1/getchildren";var URL_DISTANCE=BASE_URL+"distance/v1/";var Utils={location2query:function location2query(c){if(typeof c=="string"){return c}var b="";for(var a=0;a<c.length;a++){var e=c[a];if(!!b){b+=";"}if(e.location){b=b+e.location.lat+","+e.location.lng}if(e.latitude&&e.longitude){b=b+e.latitude+","+e.longitude}}return b},getWXLocation:function getWXLocation(c,b,a){wx.getLocation({type:"gcj02",success:c,fail:b,complete:a})},getLocationParam:function getLocationParam(b){if(typeof b=="string"){var a=b.split(",");if(a.length===2){b={latitude:b.split(",")[0],longitude:b.split(",")[1]}}else{b={}}}return b},polyfillParam:function polyfillParam(a){a.success=a.success||function(){};a.fail=a.fail||function(){};a.complete=a.complete||function(){}},checkParamKeyEmpty:function checkParamKeyEmpty(c,b){if(!c[b]){var a=this.buildErrorConfig(ERROR_CONF.PARAM_ERR,ERROR_CONF.PARAM_ERR_MSG+": "+b+"参数格式有误");c.fail(a);c.complete(a);return true}return false},checkKeyword:function checkKeyword(a){return !this.checkParamKeyEmpty(a,"keyword")},checkLocation:function checkLocation(c){var a=this.getLocationParam(c.location);if(!a||!a.latitude||!a.longitude){var b=this.buildErrorConfig(ERROR_CONF.PARAM_ERR,ERROR_CONF.PARAM_ERR_MSG+" location参数格式有误");c.fail(b);c.complete(b);return false}return true},buildErrorConfig:function buildErrorConfig(a,b){return{status:a,message:b}},buildWxRequestConfig:function buildWxRequestConfig(c,a){var b=this;a.header={"content-type":"application/json"};a.method="GET";a.success=function(d){var e=d.data;if(e.status===0){c.success(e)}else{c.fail(e)}};a.fail=function(d){d.statusCode=ERROR_CONF.WX_ERR_CODE;c.fail(b.buildErrorConfig(ERROR_CONF.WX_ERR_CODE,result.errMsg))};a.complete=function(d){var e=+d.statusCode;switch(e){case ERROR_CONF.WX_ERR_CODE:d.statusCode=ERROR_CONF.WX_ERR_CODE;c.complete(b.buildErrorConfig(ERROR_CONF.WX_ERR_CODE,d.errMsg));break;case ERROR_CONF.WX_OK_CODE:c.complete(d);break;default:c.complete(b.buildErrorConfig(ERROR_CONF.SYSTEM_ERR,ERROR_CONF.SYSTEM_ERR_MSG))}};return a},locationProcess:function locationProcess(f,e,c,a){var d=this;c=c||function(g){g.statusCode=ERROR_CONF.WX_ERR_CODE;f.fail(d.buildErrorConfig(ERROR_CONF.WX_ERR_CODE,g.errMsg))};a=a||function(g){if(g.statusCode==ERROR_CONF.WX_ERR_CODE){f.complete(d.buildErrorConfig(ERROR_CONF.WX_ERR_CODE,g.errMsg))}};if(!f.location){d.getWXLocation(e,c,a)}else{if(d.checkLocation(f)){var b=Utils.getLocationParam(f.location);e(b)}}},search:function search(a){if(!Utils.checkKeyword(a)){return}var b={keyword:a.keyword,orderby:a.orderby||"_distance",page_size:a.page_size||10,page_index:a.page_index||1,output:"json",key:a.key||"",location:Utils.getLocationParam(a.location),region:a.region||"",distance:a.distance||"1000",auto_extend:a.auto_extend||1};Utils.locationProcess(a,function(c){b.location=c.latitude+","+c.longitude;wx.request(Utils.buildWxRequestConfig(a,{url:URL_SEARCH,data:b}))})},suggestion:function suggestion(a){if(!Utils.checkKeyword(a)){return}var b={keyword:a.keyword,region:a.region||"",region_fix:a.region_fix||0,policy:a.policy||0,output:"json",key:a.key||""};wx.request(Utils.buildWxRequestConfig(a,{url:URL_SUGGESTION,data:b}))},reverseGeocoder:function reverseGeocoder(a){var b={coord_type:a.coord_type||5,get_poi:a.get_poi||0,output:"json",key:a.key||""};Utils.locationProcess(a,function(c){b.location=c.latitude+","+c.longitude;wx.request(Utils.buildWxRequestConfig(a,{url:URL_GET_GEOCODER,data:b}))})},geocoder:function geocoder(a){if(Utils.checkParamKeyEmpty(a,"address")){return}var b={address:a.address,output:"json",key:a.key||""};wx.request(Utils.buildWxRequestConfig(a,{url:URL_GET_GEOCODER,data:b}))},getCityList:function getCityList(a){var b={output:"json",key:a.key||""};wx.request(Utils.buildWxRequestConfig(a,{url:URL_CITY_LIST,data:b}))},getDistrictByCityId:function getDistrictByCityId(a){if(Utils.checkParamKeyEmpty(a,"id")){return}var b={id:a.id||"",output:"json",key:a.key||""};wx.request(Utils.buildWxRequestConfig(a,{url:URL_AREA_LIST,data:b}))},calculateDistance:function calculateDistance(a){if(Utils.checkParamKeyEmpty(a,"to")){return}var b={mode:a.mode||"walking",to:Utils.location2query(a.to),output:"json",key:a.key||""};Utils.locationProcess(a,function(c){b.from=c.latitude+","+c.longitude;wx.request(Utils.buildWxRequestConfig(a,{url:URL_DISTANCE,data:b}))})}};var QQMapWX=function(){function a(b){_classCallCheck(this,a);if(!b.key){throw Error("key值不能为空")}this.key=b.key}_createClass(a,[{key:"search",value:function search(b){return Utils.search(this.buildConfig(b))}},{key:"suggestion",value:function suggestion(b){return Utils.suggestion(this.buildConfig(b))}},{key:"reverseGeocoder",value:function reverseGeocoder(b){return Utils.reverseGeocoder(this.buildConfig(b))}},{key:"geocoder",value:function geocoder(b){return Utils.geocoder(this.buildConfig(b))}},{key:"getCityList",value:function getCityList(b){return Utils.getCityList(this.buildConfig(b))}},{key:"getDistrictByCityId",value:function getDistrictByCityId(b){return Utils.getDistrictByCityId(this.buildConfig(b))}},{key:"calculateDistance",value:function calculateDistance(b){return Utils.calculateDistance(this.buildConfig(b))}},{key:"buildConfig",value:function buildConfig(b){b.key=this.key;return b}}]);return a}();module.exports=QQMapWX; 